<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>U-Note</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
</head>
<body {% if request.args.get('theme') == 'dark' %}data-theme="dark"{% endif %}>
  <header class="hero">
    <div>
      <h1>U-Note</h1>
      <p class="subtitle">My reminders and tasks </p>
    </div>
    <div class="hero-actions">
      <span class="badge badge--subtle">Reminders: {{ counts.reminder }}</span>
      <span class="badge badge--subtle">Tasks: {{ counts.task }}</span>
    </div>
  </header>

  <main class="layout">
    <section class="panel panel--narrow">
      <div class="card">
        <h2>{% if edit_item %}Edit{% else %}New{% endif %}</h2>
        <form class="form" method="POST" action="{% if edit_item %}{{ url_for('update_item_form', item_id=edit_item.id) }}{% else %}{{ url_for('create_item_form') }}{% endif %}">
          {% if edit_item %}<input type="hidden" name="id" value="{{ edit_item.id }}" />{% endif %}

          <div class="segmented">
            <input type="radio" name="type" id="type-reminder" value="reminder" {% if not edit_item or edit_type == 'reminder' %}checked{% endif %} />
            <label for="type-reminder">Reminder</label>
            <input type="radio" name="type" id="type-task" value="task" {% if edit_item and edit_type == 'task' %}checked{% endif %} />
            <label for="type-task">Task</label>
          </div>

          <input type="text" name="title" placeholder="Title" required value="{% if edit_item %}{{ edit_item.title }}{% endif %}" />
          <textarea name="details" rows="3" placeholder="Details">{% if edit_item %}{{ edit_item.details }}{% endif %}</textarea>

          <input type="text" name="telegramChatId" placeholder="Telegram ID" value="{% if edit_item %}{{ edit_item.telegram_chat_id }}{% endif %}" />

          <p class="field__label">Remind at</p>
          <input id="datetime-field" {% if edit_item and edit_type == 'task' %}hidden{% endif %} type="datetime-local" name="datetime" value="{% if edit_item and edit_type == 'reminder' and edit_item.scheduled_at %}{{ edit_item.scheduled_at.strftime('%Y-%m-%dT%H:%M') }}{% endif %}" />
          <input id="deadline-field" {% if not edit_item or edit_type == 'reminder' %}hidden{% endif %} type="datetime-local" name="deadline" value="{% if edit_item and edit_type == 'task' and edit_item.deadline %}{{ edit_item.deadline.strftime('%Y-%m-%dT%H:%M') }}{% endif %}" />

          <input type="text" name="tags" placeholder="add any tags" value="{% if edit_item %}{{ edit_item.tags | join(', ') }}{% endif %}" />

          <div class="form__actions">
            <button type="submit" class="btn primary">{% if edit_item %}Update{% else %}Save{% endif %}</button>
            {% if edit_item %}
              <a class="btn ghost" href="{{ url_for('hello', type=filter_type, tag=filter_tag, search=search_query) }}">Cancel</a>
            {% else %}
              <button type="reset" class="btn ghost">Clear</button>
            {% endif %}
          </div>
        </form>
      </div>

      <div class="card">
        <h2>Filter</h2>
        <form class="form" method="GET" action="{{ url_for('hello') }}">
          <input type="search" name="search" placeholder="Search" value="{{ search_query }}" />
          <div class="chip-group">
            <a class="chip {% if filter_type == 'all' %}selected{% endif %}" href="{{ url_for('hello', type='all', tag=filter_tag, search=search_query) }}">All</a>
            <a class="chip {% if filter_type == 'reminder' %}selected{% endif %}" href="{{ url_for('hello', type='reminder', tag=filter_tag, search=search_query) }}">Reminders</a>
            <a class="chip {% if filter_type == 'task' %}selected{% endif %}" href="{{ url_for('hello', type='task', tag=filter_tag, search=search_query) }}">Tasks</a>
          </div>
          {% if all_tags %}
            <div class="chip-group">
              <a class="chip {% if filter_tag == 'all' %}selected{% endif %}" href="{{ url_for('hello', type=filter_type, tag='all', search=search_query) }}">All tags</a>
              {% for tag in all_tags %}
                <a class="chip {% if filter_tag == tag %}selected{% endif %}" href="{{ url_for('hello', type=filter_type, tag=tag, search=search_query) }}">#{{ tag }}</a>
              {% endfor %}
            </div>
          {% endif %}
        </form>
      </div>
    </section>

    <section class="panel">
      <div class="board">
        <div class="board__column">
          <h2>Reminders</h2>
          <div class="board__list">
            {% for item in reminders %}
              <article class="item {% if item.sent %}completed{% endif %}">
                <div class="item__header">
                  <span>⏰</span>
                  <a class="icon-button" href="{{ url_for('edit_item_form', item_id=item.id, type=filter_type, tag=filter_tag, search=search_query) }}">✎</a>
                </div>
                <h3>{{ item.title }}</h3>
                <p>{{ item.details or 'No details' }}</p>
                <p class="item__meta">
                  <span class="tag">
                    Remind at
                    {% if item.scheduled_at %}
                      {{ item.scheduled_at.strftime('%b %d, %Y %I:%M %p') }}
                    {% else %}
                      —
                    {% endif %}
                  </span>
                </p>
                <p>{% for tag in item.tags %}<span class="tag">#{{ tag }}</span>{% endfor %}</p>
                <div class="item__actions">
                  <form method="POST" action="{{ url_for('toggle_complete_form', item_id=item.id) }}">
                    <button class="btn small {% if item.sent %}btn-done{% endif %}" type="submit">
                      {% if item.sent %}Undone{% else %}Done{% endif %}
                    </button>
                  </form>
                  <form method="POST" action="{{ url_for('delete_item_form', item_id=item.id) }}"><button class="btn ghost small" type="submit">Delete</button></form>
                </div>
              </article>
            {% else %}
              <div class="empty-state">No reminders.</div>
            {% endfor %}
          </div>
        </div>

        <div class="board__column">
          <h2>Tasks</h2>
          <div class="board__list">
            {% for item in tasks %}
              <article class="item {% if item.completed %}completed{% endif %}">
                <div class="item__header">
                  <span>✅</span>
                  <a class="icon-button" href="{{ url_for('edit_item_form', item_id=item.id, type=filter_type, tag=filter_tag, search=search_query) }}">✎</a>
                </div>
                <h3>{{ item.title }}</h3>
                <p>{{ item.details or 'No details' }}</p>
                <p class="item__meta">
                  <span class="tag">
                    Remind at
                    {% if item.deadline %}
                      {{ item.deadline.strftime('%b %d, %Y %I:%M %p') }}
                    {% else %}
                      —
                    {% endif %}
                  </span>
                </p>
                <p>{% for tag in item.tags %}<span class="tag">#{{ tag }}</span>{% endfor %}</p>
                <div class="item__actions">
                  <form method="POST" action="{{ url_for('toggle_complete_form', item_id=item.id) }}">
                    <button class="btn small {% if item.completed %}btn-done{% endif %}" type="submit">
                      {% if item.completed %}Undone{% else %}Done{% endif %}
                    </button>
                  </form>
                  <form method="POST" action="{{ url_for('delete_item_form', item_id=item.id) }}"><button class="btn ghost small" type="submit">Delete</button></form>
                </div>
              </article>
            {% else %}
              <div class="empty-state">No tasks.</div>
            {% endfor %}
          </div>
        </div>
      </div>
    </section>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const reminderField = document.getElementById('datetime-field');
      const deadlineField = document.getElementById('deadline-field');
      function swap() {
        const isReminder = document.querySelector('input[name=\"type\"]:checked')?.value === 'reminder';
        reminderField.hidden = !isReminder;
        deadlineField.hidden = isReminder;
      }
      document.querySelectorAll('input[name=\"type\"]').forEach((r) => r.addEventListener('change', swap));
      swap();
    });
  </script>
</body>
</html>
