<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>U-Note</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
</head>
<body>
  <h1 class="violet">U-Note</h1>
  <p>Reminders: {{ counts.reminder }} | Tasks: {{ counts.task }}</p>
  <p>
    <a href="{{ url_for('hello', type='all') }}">All</a> |
    <a href="{{ url_for('hello', type='reminder') }}">Reminders</a> |
    <a href="{{ url_for('hello', type='task') }}">Tasks</a>
  </p>
  <hr />

  <h2 class="violet">{% if edit_item %}Edit{% else %}New{% endif %}</h2>
  <form method="POST" action="{% if edit_item %}{{ url_for('update_item_form', item_id=edit_item.id) }}{% else %}{{ url_for('create_item_form') }}{% endif %}">
    {% if edit_item %}<input type="hidden" name="id" value="{{ edit_item.id }}" />{% endif %}
    <table class="ok">
      <tr>
        <td>Type</td>
        <td>
          <label><input type="radio" name="type" value="reminder" {% if not edit_item or edit_type == 'reminder' %}checked{% endif %} /> Reminder</label>
          <label><input type="radio" name="type" value="task" {% if edit_item and edit_type == 'task' %}checked{% endif %} /> Task</label>
        </td>
      </tr>
      <tr>
        <td>Title</td>
        <td><input type="text" name="title" required value="{% if edit_item %}{{ edit_item.title }}{% endif %}" /></td>
      </tr>
      <tr>
        <td>Details</td>
        <td><textarea name="details" rows="3">{% if edit_item %}{{ edit_item.details }}{% endif %}</textarea></td>
      </tr>
      <tr>
        <td>Date</td>
        <td><input type="datetime-local" name="datetime" value="{% if edit_item and edit_type == 'reminder' and edit_item.scheduled_at %}{{ edit_item.scheduled_at.strftime('%Y-%m-%dT%H:%M') }}{% elif edit_item and edit_type == 'task' and edit_item.deadline %}{{ edit_item.deadline.strftime('%Y-%m-%dT%H:%M') }}{% endif %}" /></td>
      </tr>
      <tr>
        <td></td>
        <td>
          <button type="submit">{% if edit_item %}Update{% else %}Save{% endif %}</button>
          {% if edit_item %}
            <a href="{{ url_for('hello', type=filter_type) }}">Cancel</a>
          {% else %}
            <button type="reset">Clear</button>
          {% endif %}
        </td>
      </tr>
    </table>
  </form>
  <hr />

  <h2 class="violet">Reminders</h2>
  {% for item in reminders %}
    <table class="ok reminder {% if item.sent %}done{% endif %}">
      <tr><th colspan="2" class="note-title">{{ item.title }}</th></tr>
      <tr><td class="label">Details</td><td class="note-body">{{ item.details or 'No details' }}</td></tr>
      <tr>
        <td class="label">When</td>
        <td class="note-meta">
          {% if item.scheduled_at %}
            {{ item.scheduled_at.strftime('%b %d, %Y %I:%M %p') }}
          {% else %}
            —
          {% endif %}
        </td>
      </tr>
      <tr>
        <td class="label">Actions</td>
        <td class="note-actions">
          <a href="{{ url_for('edit_item_form', item_id=item.id, type=filter_type) }}">Edit</a>
          <form method="POST" action="{{ url_for('toggle_complete_form', item_id=item.id) }}">
            <button type="submit">{% if item.sent %}Undone{% else %}Done{% endif %}</button>
          </form>
          <form method="POST" action="{{ url_for('delete_item_form', item_id=item.id) }}"><button type="submit">Delete</button></form>
        </td>
      </tr>
    </table>
    <br />
  {% else %}
    <p>No reminders.</p>
  {% endfor %}

  <h2 class="violet">Tasks</h2>
  {% for item in tasks %}
    <table class="ok task {% if item.completed %}done{% endif %}">
      <tr><th colspan="2" class="note-title">{{ item.title }}</th></tr>
      <tr><td class="label">Details</td><td class="note-body">{{ item.details or 'No details' }}</td></tr>
      <tr>
        <td class="label">When</td>
        <td class="note-meta">
          {% if item.deadline %}
            {{ item.deadline.strftime('%b %d, %Y %I:%M %p') }}
          {% else %}
            —
          {% endif %}
        </td>
      </tr>
      <tr>
        <td class="label">Actions</td>
        <td class="note-actions">
          <a href="{{ url_for('edit_item_form', item_id=item.id, type=filter_type) }}">Edit</a>
          <form method="POST" action="{{ url_for('toggle_complete_form', item_id=item.id) }}">
            <button type="submit">{% if item.completed %}Undone{% else %}Done{% endif %}</button>
          </form>
          <form method="POST" action="{{ url_for('delete_item_form', item_id=item.id) }}"><button type="submit">Delete</button></form>
        </td>
      </tr>
    </table>
    <br />
  {% else %}
    <p>No tasks.</p>
  {% endfor %}
</body>
</html>
