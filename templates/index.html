<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>U-Note</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
</head>

<body>
  <h1 class="violet">U-Note</h1>

  <p>Reminders: {{ counts.reminder }} | Tasks: {{ counts.task }}</p>

  <p>
    <a href="{{ url_for('hello', type='all') }}"> All </a> |
    <a href="{{ url_for('hello', type='reminder') }}" class="link-success link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover"> Reminders </a> |
    <a href="{{ url_for('hello', type='task') }}" class="link-danger link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover"> Tasks </a>
  </p>

  <hr />

  <h2 class="violet"> {% if edit_item %}Edit{% else %}New{% endif %} </h2>
  
  <form id="item-form" data-mode="{% if edit_item %}edit{% else %}create{% endif %}" method="POST" action="{% if edit_item and edit_type == 'reminder' %}{{ url_for('update_reminder_form', reminder_id=edit_item.id) }}{% elif edit_item %}{{ url_for('update_task_form', task_id=edit_item.id) }}{% else %}{{ url_for('create_task_form') }}{% endif %}">
    {% if edit_item %}<input type="hidden" name="id" value="{{ edit_item.id }}" />{% endif %}
    <table class="ok">
      <tr>
        <td>Type</td>
        <td>
          <label><input type="radio" name="type" value="reminder" {% if not edit_item or edit_type == "reminder" %}checked{% endif %} /> Reminder</label>
          <label><input type="radio" name="type" value="task" {% if edit_item and edit_type == "task" %}checked{% endif %} /> Task</label>
        </td>
      </tr>
      <tr>
        <td>Title</td>
        <td><input type="text" name="title" required value="{% if edit_item %}{{ edit_item.title }}{% endif %}" /></td>
      </tr>
      <tr>
        <td>Details</td>
        <td><textarea name="details" rows="3">{% if edit_item %}{{ edit_item.details }}{% endif %}</textarea></td>
      </tr>
      <tr>
        <td>Date</td>
        <td><input type="datetime-local" name="datetime" value="{% if edit_item and edit_type == 'reminder' and edit_item.scheduled_at %}{{ edit_item.scheduled_at.strftime('%Y-%m-%dT%H:%M') }}{% elif edit_item and edit_type == 'task' and edit_item.deadline %}{{ edit_item.deadline.strftime('%Y-%m-%dT%H:%M') }}{% endif %}" /></td>
      </tr>
      <tr>
        <td></td>
        <td>
          {% if edit_item %}
            <button class="btn btn-primary" type="submit">Update</button>
            <a href="{{ url_for('hello', type=filter_type) }}">Cancel</a>
          {% else %}
            <button class="btn btn-primary" type="submit">Save</button>
            <button class="btn btn-primary" type="reset">Clear</button>
          {% endif %}
        </td>
      </tr>
    </table>
  </form>
  <hr />

  <h2 class="violet">Reminders</h2>
  {% for item in reminders %}
    <table class="ok reminder {% if item.sent %}done{% endif %}">
      <tr><th colspan="2" class="note-title">{{ item.title }}</th></tr>
      <tr><td class="label">Details</td><td class="note-body">{{ item.details or 'No details' }}</td></tr>
      <tr>
        <td class="label">When</td>
        <td class="note-meta">
          {% if item.scheduled_at %}
            {{ item.scheduled_at.strftime('%b %d, %Y %I:%M %p') }}
          {% else %}
            —
          {% endif %}
        </td>
      </tr>
      <tr>
        <td class="label">Actions</td>
        <td class="note-actions">
          <a href="{{ url_for('edit_reminder_form', reminder_id=item.id, type=filter_type) }}">Edit</a>
          <form method="POST" action="{{ url_for('toggle_reminder_complete_form', reminder_id=item.id) }}">
            <button class="btn btn-primary" type="submit">{% if item.sent %}Undone{% else %}Done{% endif %}</button>
          </form>
          <form method="POST" action="{{ url_for('delete_reminder_form', reminder_id=item.id) }}"><button class="btn btn-primary" type="submit">Delete</button></form>
        </td>
      </tr>
    </table>
    <br />
  {% else %}
    <p>No reminders.</p>
  {% endfor %}

  <hr />

  <h2 class="violet">Tasks</h2>
  {% for item in tasks %}
    <table class="ok task {% if item.completed %}done{% endif %}">
      <tr><th colspan="2" class="note-title">{{ item.title }}</th></tr>
      <tr><td class="label">Details</td><td class="note-body">{{ item.details or 'No details' }}</td></tr>
      <tr>
        <td class="label">When</td>
        <td class="note-meta">
          {% if item.deadline %}
            {{ item.deadline.strftime('%b %d, %Y %I:%M %p') }}
          {% else %}
            —
          {% endif %}
        </td>
      </tr>
      <tr>
        <td class="label">Actions</td>
        <td class="note-actions">
          <a href="{{ url_for('edit_task_form', task_id=item.id, type=filter_type) }}">Edit</a>
          <form method="POST" action="{{ url_for('toggle_task_complete_form', task_id=item.id) }}">
            <button class="btn btn-primary" type="submit">{% if item.completed %}Undone{% else %}Done{% endif %}</button>
          </form>
          <form method="POST" action="{{ url_for('delete_task_form', task_id=item.id) }}"><button class="btn btn-primary" type="submit">Delete</button></form>
        </td>
      </tr>
    </table>
    <br />
  {% else %}
    <p>No tasks.</p>
  {% endfor %}

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
